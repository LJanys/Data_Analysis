# Problem Set 2


The model used in the simulation has the following structure:

$$x_{i1}=1, x_{i2},x_{i3} \sim \mathcal{N}(0,\Sigma)$$
$$y_{i}=\mathbf{x}_i'\boldsymbol{\beta}+\varepsilon_i$$
Assume througout that $n=10000$. The aim of this problem set is to implement the F-test for joint hypothesis testing and to compare the performance of the F-test if the model assumptions upon which the test statistics are derived, are violated.

## Implementing the F-statistic
Assume initially that $\boldsymbol{\beta}=\left(\begin{matrix}1&0&0\end{matrix}\right)$ and that $\varepsilon_i\sim\mathcal{N}(0,10)$. 

Calculate the OLS estimator $\hat{\boldsymbol{\beta}}$, implement the F-Statistic and compare the value of the F-Statistic with the relevant quantile from the F-distribution. Does the global Null hold? 
```{r dgp, include=T, error=TRUE,eval=F}
k1<-rep(1, N)##generating the constant.
# We will use the command mvrnorm to draw a matrix of variables 
mu <- rep(0,M)
####beta vector###
het<-0###if equal to one: simulate a heteroskedastic model
beta.vec<-c(1,0,0)#
###We specify the correlation among the variables
###if there is correlation, right now no correlation#######################
#Sigma <- matrix(1.4, nrow=M, ncol=M) + diag(M)*.3
Sigma <- matrix(0, nrow=M, ncol=M) + diag(M)
###We draw normally distributed variables from a joint normal distribution###
rawvars <- mvrnorm(N, mu=mu, Sigma=Sigma)
###Let's see if they look normally distributed###
plot(density(rawvars[,1]))
lines(density(rawvars[,2]),col="red")
mean(rawvars[,1]);sd(rawvars[,1]);mean(rawvars[,2]);sd(rawvars[,2])
##Display the correlation matrix###
cov(rawvars);cor(rawvars)
Sigma 
X         <- cbind(k1,rawvars)
if(het==1)
{
  eps       <-X[,2]^2*rnorm(N, 0,10)
}else{ eps       <-rnorm(N, 0,10)}
###generate the model####
y         <- X %*% beta.vec + eps
##Solving for beta hat###
beta.hat <- solve(t(X) %*% X) %*% t(X) %*% y
beta.hat
# ####Now, let's calculate the  value for the t-test####
 xx<-dim(X)
 length.x<-xx[2]
 y.hat<- X %*% beta.hat
 eps.hat<-y-X %*% beta.hat
 se<-(t(eps.hat)%*%(eps.hat))/(N-length.x)###Calculate the estimate for the error variance
 cov<-se[1]*solve(t(X) %*% X)###Calculate the Covariance matrix
 d1<-sqrt(diag(cov))###The standard errors for the parameters
####Below we calculate the f-statistic as the ratio of the variances###
f<-(sum((y.hat-mean(y))^2)/(M+1-1))/(sum((y-y.hat)^2)/(N-M+1))
f.crit<-qf(.95, df1=M, df2=N-M)
result<-f>f.crit
```


## Simulation Study

Write the code above into a function that returns a logical expression whether the Null was rejected. Repeat this calculation 1000 times and record your results in a vector. What is the expected number of rejected hypotheses in this scenario? Summarize and discuss your results. 
```{r, include=T, error=TRUE,eval=F}
simu_data<-function(N,Sigma,het=0,beta.vec){
k1<-rep(1, N)##generating the constant.
# We will use the command mvrnorm to draw a matrix of variables 
mu <- rep(0,M)
###We specify the correlation among the variables
#Sigma <- matrix(1.4, nrow=M, ncol=M) + diag(M)*.3
Sigma <- matrix(0, nrow=M, ncol=M) + diag(M)
###We draw normally distributed variables from a joint normal distribution###
rawvars <- mvrnorm(N, mu=mu, Sigma=Sigma)
mean(rawvars[,1]);sd(rawvars[,1]);mean(rawvars[,2]);sd(rawvars[,2])
##Display the correlation matrix###
cov(rawvars);cor(rawvars)
Sigma 
X         <- cbind(k1,rawvars)
if(het==1)
{
  eps       <-X[,2]*rnorm(N, 0,10)
}else{ eps       <-rnorm(N, 0,10)}
###generate the model####
y         <- X %*% beta.vec + eps
##Solving for beta hat###
beta.hat <- solve(t(X) %*% X) %*% t(X) %*% y
beta.hat
####Now, let's calculate the  value for the t-test####
xx<-dim(X)
length.x<-xx[2]
y.hat<- X %*% beta.hat
eps.hat<-y-X %*% beta.hat
se<-(t(eps.hat)%*%(eps.hat))/(N-length.x)
cov<-se[1]*solve(t(X) %*% X)
d1<-sqrt(diag(cov))
f<-(sum((y.hat-mean(y))^2)/(M+1-1))/(sum((y-y.hat)^2)/(N-M+1))
f.crit<-qf(.95, df1=M, df2=N-M)
result<-f>f.crit
return(result)
}

###Make this into a function################################################################
beta.vec<-c(1,0,0)
simu_data(N,Sigma,het=0,beta.vec)
###make a vector that records the decision####################
result<-c()
reps<-100
for(i in 1:reps)
{
    set.seed(i)
  result[i]=simu_data(N,Sigma,het=0,beta.vec)
}
sum(result)
```
## Simulation study: Violating model assumptions

Re-write the function above to include the option for simulating heteroskedasticity. Come up with a suitable way to simulate heteroskedasticity in the model and run the simulation above again. What is your expectation? 

```{r, include=T, error=TRUE,eval=F}
result_het<-c()
reps<-100
for(i in 1:reps)
{
  set.seed(i)
  result_het[i]=simu_data(N,Sigma,het=1,beta.vec)
}
sum(result_het)
```




